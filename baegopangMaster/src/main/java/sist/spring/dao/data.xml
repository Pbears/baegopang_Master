<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sist.spring.dao.data">
	<insert id="insertOrderData" parameterType="java.util.HashMap">
		INSERT INTO
		ORDERDATA(STORENAME,MENUNAME,BRANDNO,WEEKDAY,ORDERDAY,ORDERMONTH,GENDER,PRICE,AMOUNT,MEMBERID,AGE)
		VALUES(#{storename},#{menuname},(SELECT BRANDNO FROM STORE WHERE
		STORENAME=#{storename}),#{weekday},#{orderday},#{ordermonth},(SELECT
		GENDER FROM MEMBER WHERE
		ID=#{memberid}),#{price},#{amount},#{memberid},(SELECT
		DECODE(TRUNC((TO_CHAR(SYSDATE,'YYYY')-TO_CHAR(M.birth,'YYYY')+1)/10),0,10,1,10,2,20,3,30,4,40,50)AGE
		FROM(SELECT birth FROM MEMBER WHERE ID=#{memberid}) M))
	</insert>

	<select id="selectGenderData" parameterType="java.util.HashMap"
		resultType="genderdata">

		SELECT MENUNAME,GENDER,ROUND(TOTALOFMOFG/SUM(TOTALOFMOFG)
		OVER()*100)RATIOMENU,ROUND(SUM(TOTALOFMOFG) OVER(PARTITION BY
		GENDER)/SUM(TOTALOFMOFG) OVER()*100)RATIOGENDER,SUM(TOTALOFMOFG)
		OVER() TOTAL,RANK() OVER(PARTITION BY GENDER ORDER BY TOTALOFMOFG
		DESC)
		RANK
		FROM(SELECT MENUNAME,GENDER,SUM(AMOUNT) TOTALOFMOFG FROM
		ORDERDATA WHERE
		STORENAME=#{storename}
		GROUP BY GENDER,MENUNAME)

	</select>


	<select id="selectWeekDayData" parameterType="java.util.HashMap"
		resultType="daydata">

		SELECT MENUNAME,WEEKDAY,ROUND(DAMOUNT/SUM(DAMOUNT)
		OVER()*100) RATIOMENU,
		RANK() OVER(PARTITION BY WEEKDAY ORDER BY
		DAMOUNT DESC)
		RANK,ROUND(SUM(DAMOUNT) OVER(PARTITION BY
		WEEKDAY)/SUM(DAMOUNT)
		OVER()*100) RATIODAY
		FROM(SELECT SUM(AMOUNT)
		DAMOUNT,WEEKDAY,MENUNAME
		FROM ORDERDATA WHERE STORENAME=#{storename}
		GROUP BY WEEKDAY,MENUNAME)

	</select>

	<select id="selectAgeData" parameterType="java.util.HashMap"
		resultType="agedata">

		SELECT
		MENUNAME,ROUND(MAMOUNT/SUM(MAMOUNT)OVER()*100)RATIOMENU,ROUND(SUM(MAMOUNT)OVER(PARTITION
		BY AGE)/SUM(MAMOUNT)OVER()*100) RATIOAGE,RANK()OVER(PARTITION BY AGE
		ORDER BY MAMOUNT DESC) RANK,AGE
		FROM (SELECT MENUNAME,
		SUM(AMOUNT)MAMOUNT,AGE
		FROM ORDERDATA
		WHERE STORENAME=#{storename}
		GROUP
		BY MENUNAME,AGE)

	</select>


	<select id="selectBrandData" parameterType="java.util.HashMap"
		resultType="branddata">

		SELECT MENUNAME,RATIOMENU,RANK()OVER(ORDER BY RATIOMENU
		DESC) RANK
		FROM(SELECT MENUNAME,
		ROUND(SUM(AMOUNT)/SUM(SUM(AMOUNT))OVER()*100)
		RATIOMENU
		FROM ORDERDATA
		WHERE BRANDNO=(SELECT BRANDNO FROM STORE WHERE STORENAME=#{storename})
		GROUP BY MENUNAME)

	</select>

	<select id="selectDaySalesData" parameterType="java.util.HashMap"
		resultType="daysales">

		SELECT ORDERDAY, SUM(SALE) DAYSALE
		FROM(SELECT
		ORDERDAY,(AMOUNT*PRICE)SALE FROM ORDERDATA WHERE
		STORENAME=#{storename})
		GROUP BY ORDERDAY
		ORDER BY ORDERDAY ASC

	</select>


	<select id="selectWeekDaySalesData" parameterType="java.util.HashMap"
		resultType="weekdaysales">

		SELECT DISTINCT WEEKDAY, ROUND(SUM(SALES) OVER(PARTITION BY
		WEEKDAY)/COUNT(ORDERDAY) OVER(PARTITION BY WEEKDAY))
		AVGSALES,COUNT(ORDERDAY) OVER(PARTITION BY WEEKDAY)COUNT,
		DECODE(WEEKDAY,'일','1','월','2','화','3','수','4','목','5','금','6','7')
		STEP
		FROM(
		SELECT WEEKDAY,ORDERDAY,(SUM(AMOUNT*PRICE))SALES
		FROM
		ORDERDATA
		WHERE STORENAME=#{storename}
		GROUP BY WEEKDAY,ORDERDAY)
		ORDER
		BY STEP

	</select>


	<select id="selectMonthSalesData" parameterType="java.util.HashMap"
		resultType="monthsales">

		SELECT DISTINCT MONTH,ROUND(SUM(SALES)OVER(PARTITION BY
		MONTH)/COUNT(ORDERMONTH) OVER(PARTITION BY MONTH))AVGSALES
		FROM(SELECT SUBSTR(ORDERMONTH,6)MONTH,ORDERMONTH,SUM(AMOUNT*PRICE)SALES
		FROM ORDERDATA
		WHERE STORENAME=#{storename}
		GROUP BY SUBSTR(ORDERMONTH,6),ORDERMONTH)
		ORDER BY MONTH

	</select>


</mapper>